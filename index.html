<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>File Uploader</title>
  <script src="./file-clerk.min.js" type="module"></script>
  <script type="module" src="/markdown-component/dist/mark-down-component.min.js"></script>
  <link rel="stylesheet" type="text/css" href="/assets/variables.css">
  <link rel="stylesheet" type="text/css" href="/assets/layout.css">
  <link rel="stylesheet" type="text/css" href="/assets/custom.css">
  <script src="https://lnsy-dev.github.io/simple-github-icon/github-icon.min.js"></script>
  <style>
    github-icon {
      position: fixed;
      right:1em;
      top: 1em;
      width: 4em;
      height: 4em;
    }
  </style>


</head>
<body>

<github-icon light href="https://github.com/lnsy-dev/file-clerk"></github-icon>

<main>
  <h1>File Clerk</h1>
  <h2>Here to save the day, as usual</h2>
<mark-down src="./README.md"></mark-down>

<h2> A Demo</h2>
<file-uploader></file-uploader>
<file-clerk id="file_clerk" verbose="true"></file-clerk>
<file-viewer id="file_viewer"></file-viewer>
<file-splitter id="file_splitter"></file-splitter>
<file-archive id="file_archive" target="#file_clerk" verbose="true"></file-archive>
<script>
  window.addEventListener('DOMContentLoaded', () => {
    const fileUploader = document.querySelector('file-uploader');
    const fileClerkEl = document.getElementById('file_clerk');
    const fileViewerEl = document.getElementById('file_viewer');
    const fileSplitterEl = document.getElementById('file_splitter');

    // Ensure custom element is defined/upgraded before calling its methods
    const onClerkReady = customElements.whenDefined('file-clerk').then(() => {
      if (customElements.upgrade) {
        customElements.upgrade(fileClerkEl);
      }
    });

    // Wire uploader -> clerk save
    fileUploader.addEventListener('fileuploaded', async (event) => {
      await onClerkReady;
      const { fileData, name, notes } = event.detail;
      fileClerkEl.saveFile(name, fileData, notes);
    });

    // Initial list
    onClerkReady.then(() => {
      if (typeof fileClerkEl.listFiles === 'function') {
        fileClerkEl.listFiles().then((res) => console.log(res));
      }
    });

    // Open -> split -> view
    fileClerkEl.addEventListener('file-opened', async (e) => {
      const rejoined_file = fileSplitterEl.joinFiles(
        fileSplitterEl.splitFiles(e.detail.contents)
      );
      fileViewerEl.openFile(rejoined_file);
    });
  });
</script>


</main>
</body>
</html>